<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.repository.UserDAO">

    <select id="selectUser" resultMap="userMap">
        SELECT u.email, u.pwd, u.nick_name, u.reg_date, u.last_login, u.profile_image, a.id, a.auth
        FROM member u
        LEFT JOIN auth a ON u.email = a.email
        WHERE u.email = #{email}
    </select>
    
    <select id="getUserList" resultMap="userMap">
        SELECT u.email, u.pwd, u.nick_name, u.reg_date, u.last_login, u.profile_image, a.id, a.auth
        FROM member u
        LEFT JOIN auth a ON u.email = a.email
    </select>

    <resultMap id="userMap" type="com.example.demo.domain.UserVO">
        <id property="email" column="email"/>
        <result property="pwd" column="pwd"/>
        <result property="nickName" column="nick_name"/>
        <result property="regDate" column="reg_date"/>
        <result property="lastLogin" column="last_login"/>
        <result property="profileImage" column="profile_image"/>
        <collection property="authList" resultMap="authMap"/>
    </resultMap>

    <resultMap id="authMap" type="com.example.demo.domain.AuthVO">
        <id property="authNo" column="id"/>
        <result property="email" column="email"/>
        <result property="auth" column="auth"/>
    </resultMap>

    <insert id="insertUser">
        INSERT INTO member (email, pwd, nick_name)
        VALUES (#{email}, #{pwd}, #{nickName})
    </insert>

    <insert id="insertAuth">
        INSERT INTO auth (email, auth)
        VALUES (#{email}, #{auth})
    </insert>

    <update id="updateUser">
        UPDATE member
        <set>
            <if test="pwd != null and pwd != ''">
                pwd = #{pwd},
            </if>
            <if test="nickName != null and nickName != ''">
                nick_name = #{nickName},
            </if>
            <if test="profileImage != null and profileImage != ''">
                profile_image = #{profileImage},
            </if>
        </set>
        WHERE email = #{email}
    </update>
    
    <delete id="deleteUser">
        DELETE FROM member WHERE email = #{email}
    </delete>

</mapper>
